---
title: Solidityå­¦ä¹ ç¬”è®°
tags:
  - Solidity
  - Ethereum
  - BlockChain
  - æ™ºèƒ½åˆçº¦
categories:
  - BlockChain
  - Solidity
date: 2019-01-26 20:22:26
---



##### é€šè¯†

ä¸€ä¸ªå­—èŠ‚å¯¹åº”8ä½(8ä¸ªäºŒè¿›åˆ¶ä½) 1B(Byte)å¯¹åº”8b(bit)

ä¸€ä¸ªåå…­è¿›åˆ¶ä½å¯¹åº”4ä¸ªäºŒè¿›åˆ¶ä½(2^4^=16)

æ‰€ä»¥==ä¸€ä¸ªå­—èŠ‚å¯¹åº”2ä¸ªåå…­è¿›åˆ¶ä½==



bytes32 32å­—èŠ‚é•¿ï¼Œå¯¹åº”64ä½åå…­è¿›åˆ¶æ•° å³256bit

address 20å­—èŠ‚é•¿ï¼Œå¯¹åº”40ä½åå…­è¿›åˆ¶æ•°ã€160ä½äºŒè¿›åˆ¶ï¼Œç›¸å½“äºuint160ã€‘



åœ°å€æ˜¯ address é•¿åº¦ä¸º40ä½(åŠ ä¸Šå¼€å¤´0xå°±42ä½)

ç§é’¥|å…¬é’¥ bytes32 é•¿åº¦ä¸º64ä½



##### åŸºæœ¬ç±»å‹

string å­—ç¬¦ä¸²ï¼Œutf-8ç¼–ç 

bool

int æœ‰ç¬¦å·æ•´æ•°

uint æ— ç¬¦å·æ•´æ•°

address 16è¿›åˆ¶ï¼Œä¸€å…±æœ‰40ä½æ•°(ä¸åŒ…æ‹¬å¼€å¤´0x)



##### æ•´æ•°

uint8 8ä½æ— ç¬¦å·æ•´æ•°ï¼Œ0~2^8^-1(255)

uint16

...

uint256

ä»¥8ä¸ºæ­¥é•¿ï¼Œuintç›¸å½“äºuint256

intç±»ä¼¼



##### å¼•ç”¨ç±»å‹

int[8] å®šé•¿æ•°ç»„

type[] åŠ¨æ€æ•°ç»„(å¤šç§ç±»å‹)ï¼Œlengthé•¿åº¦ï¼ŒpushåŠ å…¥å…ƒç´ 

struct ç»“æ„ä½“ **å¯è§æ€§åªèƒ½ä¸ºinternal,ä¸æ”¯æŒè‡ªå·±å£°æ˜**

mapping(key => value) æ˜ å°„è¡¨ (å³kvé”®å€¼å¯¹) mapping(type1=>type2) map; map[key]å¯¹åº”value

> ã€Œå¦‚ä½•åˆ¤æ–­æŸä¸ªkeyæ˜¯å¦å­˜åœ¨mappingä¸­ã€ï¼Œå…¶å®æ˜¯ä¸ºäº†è¾“å…¥ä¸åˆæ³•çš„keyæ—¶èƒ½ç»™ä¸æç¤ºï¼Œå¦åˆ™åªæ˜¯è¿”å›ç¼ºçœå€¼æˆ–è€…æ²¡ååº” è‚¯å®šä¸åˆé€‚ã€‚
>
> å…·ä½“å¯è§åˆçº¦HMS/InfoManagement.sol
>
> æœ‰ä¸ªæ¯”è¾ƒè€—gasçš„æ–¹æ³•
>
> æŠŠmappingçš„valueä¹Ÿåšä¸€ä¸ªæ•°ç»„ï¼Œvalue[] values;æ•°ç»„ä¸­éœ€è¦æœ‰mapçš„key(å³id)
>
> ä¼ å…¥å‚æ•°ä¸ºinput_id
>
> for(uint i=0;i<values.length;i++){
>
> â€‹    if(input_id==values[i].id){åˆ™è¯´æ˜input_idç¡®å®å­˜åœ¨äºmappingä¸­çš„}
>
> }



> ğŸ’¡ç‰¹åˆ«æ³¨æ„ï¼š
>
> ==!!!!å…¥å‚å’Œå‡ºå‚æ”¯æŒç»“æ„ä½“ï¼Œç»“æ„ä½“æ•°ç»„ï¼Œæ•°ç»„ï¼Œæ˜ å°„!!!!==  0.5.0  666
>
> æƒ³æ”¯æŒç»“æ„ä½“æˆ–ç»“æ„ä½“æ•°ç»„ å¼€å¤´è¦æ·»åŠ pragma experimental ABIEncoderV2;
>
>
>
> ä¼ å…¥æˆ–è¿”å›æ˜ å°„çš„å†™æ³• returns(mapping(uint=>uint) memory(æˆ–storage))
>
> åˆ‡è®°ä¼ å…¥æˆ–è¿”å›æ˜ å°„åªèƒ½åœ¨==internalæ–¹æ³•==æˆ–==libraryåº“æ–¹æ³•==ä¸­
>
>
>
> ä¼ å…¥æˆ–è¿”å›æ•°ç»„returns(uint[] memory) å½“å¯è§æ€§ä¸ºinternalæ—¶ï¼Œå¯ä¸ºstorage(å°‘ç”¨)
>
>
>
> ä¼ å…¥æˆ–è¿”å›ç»“æ„ä½“returns(structName memory)  å½“å¯è§æ€§ä¸ºinternalæ—¶ï¼Œå¯ä¸ºstorage(å°‘ç”¨)
>
> ä¼ å…¥æˆ–è¿”å›ç»“æ„ä½“æ•°ç»„returns(structName[] memory) å½“å¯è§æ€§ä¸ºinternalæ—¶ï¼Œå¯ä¸ºstorage(å°‘ç”¨)
>
>
>
> å…·ä½“å¯è§HMS/InfoManagement.solï¼Œæ‹¿æ–¹æ³•getCustomerIDs()æ¥è¯•éªŒ



==ç»“æ„ä½“==

ç›®å‰å¯èƒ½æ€§åªèƒ½ä¸ºinternalï¼Œè€Œä¸”ä¸èƒ½æ˜¾ç¤ºåœ°å†™å‡ºæ¥!

struct CustomerInfo

mapping(uint=>CustomerInfo) cinfos



åˆ‡è®°æ•°ç»„æ·»åŠ å…ƒç´ å¿…é¡»ç”¨pushï¼Œä¸èƒ½array[1]=xxx,array[2]=xxx,ä¸æ˜¯mapping,æ˜¯åºåˆ—åŒ–çš„ï¼Œä¸€å®šè¦ä¸€ä¸ªä¸ªæ¥ï¼

ç»“æ„ä½“æ·»åŠ å¯ä»¥structA.name=xxx

mappingæ·»åŠ å¯ä»¥ address[name]=â€œmyNameâ€



ç»“æ„ä½“ä¸¤ç§èµ‹å€¼æ–¹å¼ï¼š

```javascript
CustomerInfo memory hotelAdmin = CustomerInfo({
    customerName:"Administrator",
    customerID:customers.length,
    customerAge:666,
    isCrime:false});
CustomerInfo memory hotemAdmin = CustomerInfo("Admin",1,666,false);
```

æ–°å»ºç»“æ„ä½“å¿…é¡»åŠ memoryï¼Œå› ä¸ºæ–°å»ºçš„ç»“æ„ä½“æœªå±äºçŠ¶æ€å˜é‡ã€‚

è‹¥æ˜¯å°†å·²ç»å­˜åœ¨çš„çŠ¶æ€å˜é‡ç»“æ„ä½“èµ‹å€¼ç»™æ–°å£°æ˜çš„ç»“æ„ä½“ï¼Œå¯ä»¥ç”¨storage

å¦‚ CustomerInfo storage newguest = customers[0];



ğŸ’¡tips: æ–°å»ºç»“æ„ä½“ä¸æ˜¯storageï¼Œæ— æ‰€è°“å•Šï¼ŒæŠŠä»–æ·»åŠ è¿›å±äºçŠ¶æ€å˜é‡çš„æŸä¸ªæ•°ç»„é‡Œå¤´ï¼Œä»–å°±æˆçŠ¶æ€å˜é‡å•¦ã€‚



solidityç»“æ„ä½“åˆå§‹åŒ– ä¸éœ€è¦new ä¸åƒjs

Person ap = Person(172,â€˜Satoshiâ€™);



==bytes== åŠ¨æ€åˆ†é…å¤§å°çš„å­—èŠ‚æ•°ç»„

bytes byt; byt.length byt[0]ï¼Œå¯è®¿é—®é•¿åº¦å’ŒæŸä¸ªä¸‹æ ‡



bytes32 å­—èŠ‚æ•°ç»„

bytes32 å†™ä¸€ä¸ªçš„æ—¶å€™å¯ä»¥ç®€å†™0x1234ï¼Œå¿…é¡»ä¸º==å¶æ•°ä½==ï¼Œåé¢è‡ªåŠ¨è¡¥0





ğŸ’¡åˆå§‹åŒ–æ•°ç»„æ–¹æ³•ï¼š

uint[] memory values = new uint\[](3);

å†…å­˜æ•°ç»„å¿…é¡»ç”¨é•¿åº¦å‚æ•°åˆ›å»ºï¼Œåˆ›å»ºä¸€ä¸ªé•¿åº¦ä¸º3çš„æ•°ç»„

éœ€è¦è¯•ä¸€è¯•5.0ä¸­çš„æœ€æ–°æ”¹åŠ¨



##### æ•°æ®ä½ç½®

storage ä¿å­˜åœ¨çŠ¶æ€æ ‘ä¸­ï¼Œæˆå‘˜å˜é‡ä¸€èˆ¬ä½äºæ­¤å¤„|å…¨å±€å˜é‡

memory å‚æ•°ã€å±€éƒ¨å˜é‡ä¸€èˆ¬ä½äºæ­¤å¤„



æœ‰çš„å˜é‡å¯ä»¥ä½¿ç”¨ä¿®é¥°ç¬¦æ¥æ”¹å˜å˜é‡ä½ç½®ï¼Œä½†æ˜¯==çŠ¶æ€å˜é‡ä¸å¯æ”¹å˜ä½ç½®==ã€‚

ä¸¤ä¸ªä¸åŒä½ç½®çš„å¼•ç”¨å˜é‡ï¼Œä¼šå¯¼è‡´æ·±æ‹·è´è­¦å‘Š



memory å€¼ä¼ é€’ï¼Œæ‹·è´ï¼Œä¸æ”¹å˜æºæ•°æ®

storage å¼•ç”¨ä¼ é€’ï¼Œç›¸å½“äºæŒ‡é’ˆï¼Œä¼šæ”¹å˜æºæ•°æ®



å¼ºåˆ¶æŒ‡å®šçš„æ•°æ®ä½ç½®ï¼š

- å¤–éƒ¨å‡½æ•°çš„å‚æ•°ï¼ˆä¸åŒ…æ‹¬è¿”å›å‚æ•°ï¼‰ï¼š calldata
- çŠ¶æ€å˜é‡ï¼š storage

é»˜è®¤æ•°æ®ä½ç½®ï¼š

- å‡½æ•°å‚æ•°ï¼ˆåŒ…æ‹¬è¿”å›å‚æ•°ï¼‰ï¼š memory
- æ‰€æœ‰å…¶å®ƒå±€éƒ¨å˜é‡ï¼š storage



> å‡½æ•°å‚æ•°é»˜è®¤ä¸ºmemoryï¼Œæƒ³æ˜¾ç¤ºå£°æ˜æ•°æ®ä½ç½®çš„åªèƒ½ä¸ºstruct|array|mapping
>
> ä¸‰ç§æ•°æ®ç±»å‹ï¼Œå…¶ä»–æ•°æ®ç±»å‹éƒ½ä¸å¯åŠ memoryæˆ–storageå£°æ˜
>
> æœ€æ–°ç‰ˆæœ¬ï¼stringç±»å‹çš„å‡½æ•°å‚æ•°éœ€è¦æ˜¾ç¤ºå¢åŠ memoryå£°æ˜



æ³¨æ„ğŸ’¡: ==å‡½æ•°ä¸­ç»“æ„ä½“å’Œæ•°ç»„çš„å£°æ˜å’Œèµ‹å€¼==éœ€è¦æ˜¾ç¤ºæ ‡ä¸ºstorageæˆ–è€…memoryï¼Œä¸å£°æ˜ä¼šæŠ¥warning(é»˜è®¤ä¸ºstorage),è€Œå…¶ä»–ç±»å‹(åŒ…æ‹¬mapping)éƒ½ä¸èƒ½å¸¦storageæˆ–memoryå£°æ˜ã€‚



å‡½æ•°ä¸­æ— æ³•å£°æ˜ä¸´æ—¶mappingï¼Œmappingä¸€å®šä¼šä½œä¸ºçŠ¶æ€å˜é‡å­˜åœ¨çš„ï¼Œå‡½æ•°ä¸­å£°æ˜mappingä¹Ÿéœ€è¦åˆå§‹åŒ–è€Œä¸”è¦å°†ä¸€ä¸ªçŠ¶æ€å˜é‡mapping(A)èµ‹å€¼ç»™ä»–ï¼Œè¿™æ—¶ç”¨å£°æ˜çš„mappingç›¸å½“äºåœ¨ç”¨mappingAäº†ã€‚



åˆçº¦ä¸­å‡½æ•°å¤–çš„å£°æ˜éƒ½æ˜¯çŠ¶æ€å˜é‡ï¼Œéƒ½å­˜åœ¨storageä¸­ï¼Œä¸èƒ½æ˜¾ç¤ºåŠ ä¸Šmemoryæˆ–storageå£°æ˜ã€‚



Person p = persons[_index];
p.age = _age;

//æ”¹å˜ageä¼šå½±å“åŸæ¥çš„å€¼



Person memory p = persons[_index];
p.age = _age;

//æ”¹å˜ageä¸ä¼šå½±å“åŸæ¥çš„å€¼





ä¾‹å­ï¼šhttps://cryptozombies.io/zh/lesson/3/chapter/12



æ‰¹é‡åˆ é™¤æ•°ç»„å…ƒç´ ï¼Œæœ‰ä¸¤ç§æ–¹æ³•ï¼Œç¬¬ä¸€ç§ç¬¦åˆç›´è§‰ï¼Œä½†æ˜¯ç‰¹åˆ«è´¹gas

- æ–¹æ³•éœ€è¦ä¼ å…¥storageæ•°ç»„å‚æ•°ï¼Œæ•°ç»„çš„åˆ é™¤é¡¹åé¢çš„æ¯ä¸ªé¡¹éƒ½å¾€å‰æŒªä¸€ä½(å³é‡æ–°èµ‹å€¼)ï¼Œç„¶åå†å°†æ•°ç»„é•¿åº¦å‡1ã€‚

  å› ä¸ºéœ€è¦ä¿®æ”¹storageå˜é‡ï¼Œæ¯åŠ¨ä¸€é¡¹éƒ½è¦æ¶ˆè€—gasï¼Œè´µ

- æ–¹æ³•äºŒ:ç”±äºå¤–éƒ¨è°ƒç”¨viewå‡½æ•°å…è´¹ï¼Œå¯ä»¥ç”¨forå¾ªç¯éå†æ•´ä¸ªæ•°ç»„æŠŠç¬¦åˆè¦æ±‚çš„æŒ‘å‡ºæ¥æ„å»ºå‡ºæ•°ç»„ï¼Œè¿™æ ·ä¼šä¾¿å®œçš„å¤šå¾—å¤šã€‚(éœ€è¦åšifåˆ¤æ–­)



æ‰¹é‡èµ‹å€¼

```javascript
uint a;
uint b;
uint c;
// è¿™æ ·æ¥åšæ‰¹é‡èµ‹å€¼:
(a, b, c) = (1,2,3)
```

##### å†…å»ºå¯¹è±¡

==**block**==

block.blockhash(uint blockNumber) returns (bytes32) æŒ‡å®šå—çš„å“ˆå¸Œ

block.coinbase (address) å½“å‰å—çŸ¿å·¥åœ°å€

block.difficulty (uint) å½“å‰å—éš¾åº¦å€¼

block.gaslimit (uint) å½“å‰å—gaslimit

block.number (uint) å½“å‰å—å—å·(åŒºå—é«˜åº¦)

block.timestamp (uint) å½“å‰å—æ—¶é—´æˆ³



==**msg**==

è°ƒç”¨æ–¹æ³•æ—¶ï¼Œä¼šç»™æ–¹æ³•ä¼ é€’ä¸€ä¸ªmsgå±æ€§

msg.data (byte) å®Œæ•´çš„calldata

msg.gas (uint) å‰©ä½™gas

msg.sender (address)å½“å‰æ¶ˆæ¯çš„å‘é€è€…

msg.sig (bytes4) å‘¼å«æ•°æ®çš„å‰å››ä¸ªå­—èŠ‚(å³åŠŸèƒ½æ ‡è¯†ç¬¦)

msg.value (uint) å‘é€çš„æ¶ˆæ¯çš„æ•°é‡(å‘é€çš„tokenæ•°é‡)



==now==

å³block.timestapçš„åˆ«å å½“å‰å—æ—¶é—´æˆ³



==address==

\<address\>.balance

\<address\>.transfer(uint256 amount) å‘é€æŒ‡å®šæ•°é‡etheråˆ°åœ°å€ï¼Œå¤±è´¥æ—¶æŠ›å¼‚å¸¸ï¼Œ



\<address\>.send(uint256 amount) returns (bool)  

å‘é€æŒ‡å®šæ•°é‡etheråˆ°åœ°å€ï¼Œå¤±è´¥æ—¶è¿”å›false



\<address\>.call(...) returns (bool)

\<address\>.callcode(...) returns (bool)

\<address\>.delegatecall(...) returns (bool)



getBalance()æ–¹æ³•

return this.balance;

æ›´å®‰å…¨çš„å†™æ³•æ˜¯return address(this).balance;



thisä»£è¡¨å½“å‰åˆçº¦çš„åœ°å€ï¼Œåˆçº¦åœ°å€ï¼

msg.senderä»£è¡¨å½“å‰è°ƒç”¨äººçš„åœ°å€ï¼Œå¤–éƒ¨è´¦æˆ·åœ°å€ï¼



==tx==

- **tx.gasprice (uint)**  gasä»·æ ¼

- **tx.origin (address)** äº¤æ˜“çš„å‘é€è€…ï¼ˆå…¨è°ƒç”¨é“¾ï¼‰

  Solidityæœ‰ä¸€ä¸ªå…¨å±€å˜é‡tx.originï¼Œå®ƒéå†æ•´ä¸ªè°ƒç”¨å †æ ˆï¼Œå¹¶è¿”å›åŸå…ˆå‘é€è°ƒç”¨ï¼ˆæˆ–äº‹åŠ¡ï¼‰çš„å¸æˆ·åœ°å€ã€‚

  å¦‚æœä¸€ä¸ªå‡½æ•°çš„è°ƒç”¨è€…è§„å®šå¿…é¡»ä¸ºå¤–éƒ¨è´¦æˆ·ï¼Œç„¶è€Œè¿™ä¸ªåˆçº¦Bæ˜¯è¢«å…¶ä»–åˆçº¦Aéƒ¨ç½²çš„ï¼Œè¿™æ—¶ç”¨msg.senderä¼šè·å¾—å¤–éƒ¨è´¦æˆ·åœ°å€è€Œä¸æ˜¯åˆçº¦åœ°å€ï¼Œå¦‚æœä½¿ç”¨tx.originåˆ™å¯ä»¥è·å¾—æœ€å…ˆéƒ¨ç½²åˆçº¦Açš„å¤–éƒ¨è´¦æˆ·çš„åœ°å€äº†ã€‚

  ä¸è¿‡è¦æ³¨æ„å®‰å…¨é—®é¢˜ï¼Œä¸€èˆ¬è¾ƒå°‘ä½¿ç”¨ã€‚

  æœ‰ä¸€ä¸ªåˆ¤æ–­require(msg.sender==tx.origin)ä»€ä¹ˆå«ä¹‰å‘¢ï¼Ÿ

##### å†…ç½®å‡½æ•°

addmod(uint x,uint y,uint k) returns (uint) (x+y)%k

mulmod(uint x,uint y,uint k) returns (uint) (x*y)%k

keccak256(...) returns(bytes32)

å˜å‚ï¼Œå¯ä¼ å¤šä¸ªå‚æ•°

sha3 keccak256åˆ«å



assert(bool condition)

require(bool condition)

revert();



assertæ¯”è¾ƒè‡ªä¿¡ï¼Œæ–­è¨€æ­¤äº‹ä¸å‘ç”Ÿï¼Œå‘ç”Ÿä¼šæƒ©ç½š æ‰£å…‰æ‰€æœ‰gas

requireæ¯”è¾ƒæ¸©å’Œï¼Œå¦‚æœæ¡ä»¶ä¸æ»¡è¶³ï¼Œé€€å›å‰©ä½™gasï¼Œç”¨çš„æ›´å¤š

revertä¸»åŠ¨é€€å›gasï¼Œif/elseåˆ¤æ–­åä½¿ç”¨

assertå¤šç”¨äºåˆ¤æ–­éçŠ¶æ€å˜é‡

assertå¯è€ƒè™‘æ”¾åœ¨å‡½æ•°ç»“å°¾éƒ¨åˆ†ç”¨äºéªŒè¯ä¹‹å‰çš„æ“ä½œç»“æœçš„æ­£ç¡®æ€§



solidityå†…éƒ¨æœ‰thisï¼Œaddress(this)

selfdestruct(address) é”€æ¯åˆçº¦ï¼Œaddressæ˜¯æ”¶ç›Šäºº(é”€æ¯åé’±è½¬ç»™)



##### éšæœºæ•°ç”Ÿæˆæ–¹æ³•

keccak256å‡½æ•°ï¼š

uint random = uint(keccak256(block.difficulty,now));



blockhashæ³•:

uint random = uint(block.blockhash(block.number-1)); //ï¼Ÿå¾…æŸ¥





ä¸åƒjsï¼Œå˜é‡çš„èµ‹å€¼|å‡½æ•°çš„æ‰§è¡Œ ä¸èƒ½ç›´æ¥å†™åœ¨åˆçº¦ä¸­çš„ï¼Œè€Œæ˜¯å†™åœ¨å‡½æ•°ä¸­ï¼Œè¿™äº›æ“ä½œæ˜¯å¯èƒ½éœ€è¦æ¶ˆè€—gasçš„ã€‚æˆ–è€…å†™åœ¨jsä¸­ï¼Ÿ



#### å‡½æ•°



##### å‡½æ•°å£°æ˜

å®šä¹‰

ä¿®é¥°

è°ƒç”¨

è¿”å›å€¼(å¯ä»¥å¤šä¸ªï¼Œ***æœ€å¤š7ä¸ª***ï¼Œå¯çœç•¥åå­—) å¯return (v0,v1,...,vn)

fallback(åŒ¿åå‡½æ•°)



##### å‡½æ•°ä¿®é¥°ç¬¦

ğŸ’¡ åˆ‡è®°åŒºåˆ†å¯è§æ€§(å¯è°ƒç”¨çš„ä½ç½®)å’Œèƒ½ä¸èƒ½çœ‹è§å‡½æ•°å†…å®¹æ˜¯ä¸åŒçš„

è°ƒç”¨å…¶ä»–åˆçº¦(é™¤ç»§æ‰¿å¤–)éœ€è¦å…ˆè·å¾—ä¸€ä¸ªå…¶ä»–åˆçº¦å®ä¾‹c,ç„¶åc.functionxx()



> ğŸ’¡
>
> - å‡½æ•°å£°æ˜æ—¶é»˜è®¤ä¸º**`public`**ç±»å‹ï¼Œå’Œæ˜¾ç¤ºå£°æ˜ä¸º**`public`**ç±»å‹çš„å‡½æ•°ä¸€æ ·ï¼Œéƒ½å¯ä¾›å¤–éƒ¨è®¿é—®ã€‚
> - æ„é€ å‡½æ•°å¤§éƒ¨åˆ†æƒ…å†µä¸‹éƒ½å£°æ˜ä¸º`public`ç±»å‹ã€‚
> - æ‰€æœ‰åœ¨åˆçº¦å†…çš„ä¸œè¥¿å¯¹å¤–éƒ¨çš„è§‚å¯Ÿè€…æ¥è¯´éƒ½æ˜¯å¯è§çš„ï¼Œå°†æŸäº›ä¸œè¥¿æ ‡è®°ä¸º**`private`**ä»…ä»…é˜»æ­¢äº†å…¶å®ƒåˆçº¦æ¥è¿›è¡Œè®¿é—®(è°ƒç”¨)å’Œä¿®æ”¹ï¼Œä½†å¹¶ä¸èƒ½é˜»æ­¢å…¶å®ƒäººçœ‹åˆ°ç›¸å…³çš„ä¿¡æ¯[å¯ä»¥çœ‹åˆ°å‡½æ•°æ˜¯å¹²å•¥çš„ï¼Œå‡½æ•°ä½“é‡Œå¤´æœ‰å•¥å†…å®¹ï¼Œä½†æ˜¯æ²¡æ³•è°ƒç”¨ï¼Œæ²¡æ³•æ”¹]ã€‚
> - å¯è§æ€§çš„æ ‡è¯†ç¬¦çš„å®šä¹‰ä½ç½®ï¼Œ==å¯¹äºå˜é‡å£°æ˜æ¥è¯´æ˜¯åœ¨ç±»å‹çš„åé¢==ï¼Œ==å¯¹äºå‡½æ•°å£°æ˜æ¥è¯´æ˜¯åœ¨å‚æ•°åˆ—è¡¨å’Œè¿”å›å…³é”®å­—(returns)ä¸­é—´==ã€‚
> - çŠ¶æ€å˜é‡å£°æ˜æ—¶ï¼Œé»˜è®¤ä¸º**`internal`**ç±»å‹ï¼Œåªæœ‰æ˜¾ç¤ºå£°æ˜ä¸º**`public`**ç±»å‹çš„çŠ¶æ€å˜é‡æ‰ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªå’ŒçŠ¶æ€å˜é‡åŒåçš„**`get`**å‡½æ•°ä»¥ä¾›å¤–éƒ¨è·å–å½“å‰çŠ¶æ€å˜é‡çš„å€¼ã€‚çŠ¶æ€å˜é‡æ— æ³•å£°æ˜ä¸º`external`ç±»å‹ã€‚



###### å¯è§æ€§ ä¸åˆ»æ„å£°æ˜æ—¶æœ‰é»˜è®¤å€¼

å‡½æ•°å¯è§æ€§é»˜è®¤ä¸ºpublic

çŠ¶æ€å˜é‡å¯è§æ€§é»˜è®¤ä¸ºinternal æ— æ³•å£°æ˜ä¸ºexternal

ç»“æ„ä½“é»˜è®¤ä¸ºinternal ä¸”æ— æ³•åŠ ä»»ä½•å…¶ä»–çš„å¯è§æ€§å£°æ˜

| ä¿®é¥°ç¬¦       | æ„ä¹‰                                                         |        åˆ†ç±»        |
| ------------ | ------------------------------------------------------------ | :----------------: |
| public       | ä»»ä½•äºº(åŒ…æ‹¬å„¿å­)å¯ä»¥è°ƒç”¨(åŒä¸€ä¸ªsolæ–‡ä»¶å†…éƒ¨å¯ä»¥ç›´æ¥è°ƒç”¨,å…¶ä»–æ–‡ä»¶éœ€è¦importå¼•å…¥)è¯¥å‡½æ•°ï¼Œå’Œprivateäº’æ–¥ |     è°ƒç”¨æ§åˆ¶ç±»     |
| private      | åªæœ‰è¯¥åˆçº¦èƒ½è°ƒç”¨(å„¿å­éƒ½ä¸å¯)ï¼Œå’Œpublicäº’æ–¥                   |     è°ƒç”¨æ§åˆ¶ç±»     |
| external     | å¤–éƒ¨å‡½æ•°ã€‚å†…éƒ¨ä¸å¯è®¿é—®(å¯this)ï¼Œå¤–éƒ¨æ­£å¸¸è®¿é—®ï¼Œå­ç±»å¯ç»§æ‰¿ã€‚   |     è°ƒç”¨æ§åˆ¶ç±»     |
| internal     | å†…éƒ¨å‡½æ•°ã€‚å†…éƒ¨æ­£å¸¸è®¿é—®ï¼Œå¤–éƒ¨æ— æ³•è®¿é—®ï¼Œå­ç±»å¯ç»§æ‰¿ã€‚           |     è°ƒç”¨æ§åˆ¶ç±»     |
| view         | åˆçº¦ä¸ä¿®æ”¹çŠ¶æ€å˜é‡ï¼Œå’Œconstantä¸€æ ·                           | çŠ¶æ€å˜é‡è®¿é—®æ§åˆ¶ç±» |
| constant     | åˆçº¦ä¸ä¿®æ”¹çŠ¶æ€å˜é‡ï¼Œå’Œconstantä¸€æ ·                           | çŠ¶æ€å˜é‡è®¿é—®æ§åˆ¶ç±» |
| pure         | åˆçº¦ä¸ä½†ä¸ä¿®æ”¹ï¼Œä¹Ÿä¸è¯»å–çŠ¶æ€å˜é‡                             | çŠ¶æ€å˜é‡è®¿é—®æ§åˆ¶ç±» |
| payable      | æ¶‰åŠeth(å…¶ä»–tokenä¸ç®—)çš„è½¬ç§»æ“ä½œéœ€è¦åŠ ä¸Šè¿™ä¸ª                 |     èµ„é‡‘æ§åˆ¶ç±»     |
| è‡ªå®šä¹‰ä¿®é¥°ç¬¦ | è‡ªå®šä¹‰ä¿®é¥°ç¬¦å·modifier                                       |    è‡ªå®šä¹‰æ§åˆ¶ç±»    |

å‡½æ•°ä¸­æœ‰transferã€sendç­‰æ–¹æ³•ï¼Œåˆ™éœ€è¦åŠ ä¸Špayableä¿®é¥°

åˆçº¦ä¸­çš„structæ•°ç»„çš„å¯è§æ€§åªæ”¯æŒinternal(é»˜è®¤å€¼ï¼Œä¸éœ€è¦å†™)ï¼Œä¸èƒ½å£°æ˜å…¶ä»–å¯è§æ€§ï¼ï¼(æ–°ç‰ˆæœ¬ä¹Ÿçœ‹ä¸‹)



==externalè°ƒç”¨æ³¨æ„==

åˆçº¦å†…æˆ–åä»£åˆçº¦(ç»§æ‰¿)éœ€è¦ç”¨thisæ–¹å¼è°ƒç”¨ï¼Œæ­¤å¤–åˆçº¦å¤–éƒ¨ç›´æ¥ç”¨åˆçº¦å®ä¾‹è°ƒå³å¯ã€‚b.externalFn();



==å‡½æ•°è¿”å›å€¼returnç”¨æ³•==

1. function .. returns (type \_result){...;\_result = xxx;}

   å®šä¹‰å‡ºå‚æ—¶åŠ ä¸Šå˜é‡åï¼Œå‡½æ•°ä½“ä¸å†™return

2. function .. returns (type){...;return result;}

   å®šä¹‰å‡ºå‚æ—¶ä¸åŠ å˜é‡åï¼Œå‡½æ•°ä½“å†™return

å‡½æ•°è‹¥å£°æ˜æˆprivateç§æœ‰çš„ï¼Œremixå³ä¾§å·¥å…·æ æ˜¯æ— æ³•çœ‹åˆ°å’Œè°ƒç”¨çš„ï¼›å£°æ˜æˆexternalå’Œpublicæ‰å¯ä»¥ã€‚

viewå’Œconstantåœ¨remixä¸­ä¸ºè“è‰²çš„ï¼Œpureå¯ç”¨äºè®¡ç®—(åªæ˜¯ä¼ å‚ï¼Œä¸å…³å¿ƒåˆ«çš„)

publicå˜é‡ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªåŒåæŸ¥è¯¢å‡½æ•°ï¼Œè“è‰²ã€‚



æŸ¥è¯¢æœ€å¥½å¸¦ä¸Šviewï¼Œå› ä¸ºä¸æ¶ˆè€—gaså•Šï¼Œç»™åŠ›



å‡½æ•°å¤šä¸ªè¿”å›å€¼ï¼Œåªæƒ³å–åé¢çš„è¿”å›å€¼çš„æ–¹æ³•ï¼š

> (,,,,,result) = functionA();



==returnåœ¨å“ªçœ‹==

1. åœ¨æ§åˆ¶å°debugçš„decoded outputå­—æ®µçœ‹
2. åœ¨å³ä¾§å·¥å…·çª—å£debuggeré¡µç­¾çš„Solidity Stateçœ‹æ‰€æœ‰çŠ¶æ€ï¼Œè¿™å„¿å¯ä»¥çœ‹åˆ°
3. å¦‚æœå¸¦ä¸Šviewä¿®é¥°ç¬¦ï¼Œç›´æ¥åœ¨å³ä¾§ç•Œé¢å¯ä»¥çœ‹ï¼Œè°ƒç”¨æ–¹æ³•åå°±åœ¨å‡½æ•°åä¸‹å¯ä»¥çœ‹åˆ°



==ï¼æ³¨æ„æ³¨æ„ï¼==

viewå’Œpureçš„å‡½æ•° è¢«åˆçº¦å¤–éƒ¨(å³å¤–éƒ¨è´¦æˆ·)è°ƒç”¨æ—¶ä¸èŠ±è´¹gas

ä½†å®ƒä»¬è¢«å†…éƒ¨å…¶ä»–å‡½æ•°è°ƒç”¨æ—¶ ä¼šè€—è´¹gas (å–å†³äºä¸»è°ƒå‡½æ•°)





##### require assert revert



if(msg.sender==owner){

//dosomething

}else{

â€‹    revert();

}

ä¸æ»¡è¶³æ¡ä»¶ä¼šrevertå›æ»š

æ›´å¥½çš„å†™æ³•

require(msg.sender\==owner)//æˆ–assert(msg.sender==owner)

//dosomething

æ•ˆæœä¸€æ ·ï¼Œä½†æ›´ç®€æ´æ›´è¯­ä¹‰åŒ–



##### äº‹ä»¶

å¯ç”¨äºæ‰“æ—¥å¿—

åœ¨logsé¡¹ä¸­çš„eventå­—æ®µå¯ä»¥çœ‹åˆ°äº‹ä»¶ä¸­å®šä¹‰äº†çš„å‚æ•°



å£°æ˜ï¼š

Event BidEvent(address \_myAddr,uint \_myMoney)

ä½¿ç”¨ï¼š

åœ¨å‡½æ•°ä¸­å‘å°„ emit BidEvent(myAddr,myMoney); 



##### æ•°ç»„

pushæ–¹æ³•åªèƒ½å¯¹å˜é•¿æ•°ç»„ä½¿ç”¨

å¦‚æœæƒ³ç”¨deleteåˆ æ•°ç»„å…ƒç´ ï¼Œä¹Ÿç”¨å˜é•¿æ•°ç»„å§



##### å­—ç¬¦ä¸²

abi.encodePacked(a,b) è¿æ¥ä¸¤ä¸ªå­—ç¬¦ä¸²



##### web3.js

RPCæ–¹å¼è®¿é—®ä»¥å¤ªåŠç½‘ç»œ

> èµ„æ–™ï¼š
> http://cw.hubwiz.com/card/c/web3.js-1.0/1/4/7/



viewè“è‰²çš„ ç”¨callæ¥è°ƒç”¨ï¼Ÿ

çº¢è‰²çš„ä¸å¸¦viewçš„ ç”¨sendæ¥è°ƒç”¨ï¼Ÿ



==è°ƒç”¨å…³é”®ç‚¹==

è¿æ¥åˆ°ä»¥å¤ªåŠ

å·²çŸ¥åˆçº¦ABI

å·²çŸ¥åˆçº¦åœ°å€(é€šè¿‡ABIä¹Ÿå¯ä»¥éƒ¨ç½²æ–°åˆçº¦) çŸ¥é“ABIå’Œåˆçº¦åœ°å€å¯ä»¥è·å¾—åˆçº¦å®ä¾‹

ä»¥å¤ªåŠå®¢æˆ·ç«¯æ”¯æŒrpc



1. åˆ›å»ºåˆçº¦å¯¹è±¡

2. é€šè¿‡åˆçº¦åœ°å€å’Œåˆçº¦abiè·å¾—åˆçº¦å®ä¾‹

3. è°ƒç”¨åˆçº¦ä¸­çš„æ–¹æ³•

   å®ä¾‹.methods.functionName().call()



æˆ–è€…methods.functionName().send()



callå¯ä»¥ä¸ç”¨fromå’Œgasï¼Œsendå¿…é¡»æœ‰fromå’Œgas

call(function(){})



send({},function(){})



###### At Address åŠ è½½å·²éƒ¨ç½²åˆçº¦

ä¹‹å‰éƒ¨ç½²è¿‡çš„åˆçº¦ï¼Œæœ‰æ•°æ®ï¼Œ



##### importå¼•å…¥çš„ç”¨æ³•

- import â€œ./xxx.solâ€
- 

##### åº“libraryçš„ç”¨æ³•

1. import {Console} from "./Console.sol"; //Consoleä¸ºlibraryåå­—

   ä½¿ç”¨æ—¶Console.log(xxx) è°ƒç”¨åº“å.æ–¹æ³•

2. import "./AddressUtils.sol";

   åˆçº¦å†… using AddressUtils for address; ç„¶åaddressç±»å‹è‡ªå¸¦æ–¹æ³•isContract

   ä½¿ç”¨æ—¶isContract(addrxxx) æˆ–è€… addrxx.isContract()?





##### solidity 0.5.0é‚£äº›äº‹

https://www.colabug.com/4931922.html



- åœ°å€åˆ†ä¸ºaddresså’Œaddress payable,å¿…é¡»æ˜¾å¼å£°æ˜äº†payableæ‰å¯ä»¥transfer send
- external çš„å‡½æ•°å‚æ•°(æ™®é€šç±»å‹æ•°ç»„!ç±»å‹)éœ€æ˜¾å¼å£°æ˜ä¸º calldata,å…¶ä»–æŒ‰å„è‡ªè§„åˆ™æ¥ã€‚
- keccak256(abi.encodePacked(a,b,c)) å¿…é¡»åŠ ä¸Šabi.encodePacked
- bytes32æ— æ³•è½¬ä¸ºuint8,ä½†æ˜¯å¯ä»¥è½¬ä¸ºuint(å³uint256)
- uintå’Œuint8 ä¸€èµ·è¿ç®—å¯èƒ½ä¼šè¢«ç¦æ­¢
- selfdestructå‚æ•°çš„åœ°å€aå¿…é¡»ä¸ºaddress payable,å› ä¸ºè¦æŠŠé’±æ‰“åˆ°aé‚£å„¿,payableæ‰å¯ä»¥æ¥æ”¶é’±ã€‚
- æœ€æ–°ç‰ˆæœ¬ï¼stringç±»å‹çš„å‡½æ•°å‚æ•°éœ€è¦æ˜¾ç¤ºå¢åŠ memoryå£°æ˜